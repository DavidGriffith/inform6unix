<HTML><HEAD><TITLE>Section 19: Starting, moving, changing and killing the player</TITLE></HEAD>
<BODY BGCOLOR="#FFFFFF">
<TABLE></SMALL>
<TR><TD><TD><P>
<TR><TD Valign="top"><A HREF="contents.html">Contents</A><BR><A HREF="section18.html">Back</A><BR><A HREF="section20.html">Forward</A><TD bgcolor="#F5DEB3"><BLOCKQUOTE><H3>19. Starting, moving, changing and killing the player</H3></BLOCKQUOTE><TR><TD><TD>
<P>

<BLOCKQUOTE>
There are only three events in a man's life; birth, life and death;
he is not conscious of being born, he dies in pain and he forgets
to live.
<P>...Jean de la Bruy&#233;re (<B>1645</B>--<B>1696</B>)</BLOCKQUOTE>
<BLOCKQUOTE>
<BR>Life's but a walking shadow, a poor player
<BR>That struts and frets his hour upon the stage
<BR>And then is heard no more; it is a tale
<BR>Told by an idiot, full of sound and fury,
<BR>Signifying nothing.
<BR><P>...William Shakespeare (<B>1564</B>--<B>1616</B>), <I>Macbeth V. v</I></BLOCKQUOTE>
<P>


The only compulsory task for a game's <TT>Initialise</TT> routine is to
set the <TT>location</TT> variable to the place where the player should begin.
This is usually a room (and is permitted to be one that's in darkness)
but could instead be an object inside a room, such as a chair or a bed.
If you would like to give the player some items to begin with, <TT>Initialise</TT>
should also <TT>move</TT> them to <TT>player</TT>.
<P>

Games with a long opening sequence might want to start by offering the player
a chance to restore a saved game at once.  They can do so by writing the
following in their <TT>Initialise</TT> routines:
<PRE>
    print "Would you like to restore a game?  &#62;";
    if (YesOrNo()) &#60;Restore&#62;;
</PRE>
<P>

(If you want to make the status line invisible during an opening sequence, see
<A HREF="section33.html">Section 33</A>.)  <TT>Initialise</TT> normally returns 0 or 1 (it doesn't matter which), but
if it returns 2 then no game banner will be printed at once.  (This is for
games which, like 'Sorcerer', delay their banners until after the prologue.)
'Ruins', however, opens in classical fashion:
<PRE>
[ Initialise;
  TitlePage();
  location = Forest;
  move food_ration to player;
  move sodium_lamp to player;
  move dictionary to player;
  thedark.description = "The darkness of ages presses in on you, and you
      feel claustrophobic.";
 "^^^^^Days of searching, days of thirsty hacking through the briars of
  the forest, but at last your patience was rewarded. A discovery!^";
];
</PRE>

<P>
(The <TT>TitlePage</TT> routine will be an exercise in <A HREF="section33.html">Section 33</A>: 'Ruins' is really
too small a game to warrant one, but never mind.)
The <TT>location</TT> variable needs some explanation.  It holds either the current
room, if there's light to see by, or the special value <TT>thedark</TT> (the
"Darkness'' object) if there isn't.  In the latter case (but only in the
latter case) the actual current room is held in the variable <TT>real_location</TT>,
should you need to know it.  Neither of these is necessarily the same as
the parent of the <TT>player</TT> object.  For instance, if the player sits in a
jeep parked in a dark garage, then <TT>location</TT> is <TT>thedark</TT>, <TT>real_location</TT>
is <TT>Garage</TT> and <TT>parent(player)</TT> is <TT>jeep</TT>.
<P>

Because of this, one shouldn't simply <TT>move</TT> the player object by hand.
Instead, to move the player about (for teleportation of some kind),
use the routine <TT>PlayerTo(place);</TT> (which automatically takes care of
printing the new room's description if there's enough light there to see
by).
<P>

<P><TR><TD Valign="top"><IMG SRC="icons/dbend.gif" ALT="/\"><TD bgcolor="#EEEEEE"><SMALL> <TT>PlayerTo</TT> can also be used to move the player to a <TT>place</TT> inside
a room (e.g., a cage, or a traction engine).
</SMALL>
<TR><TD><TD><P>

<P><TR><TD Valign="top"><IMG SRC="icons/dbend.gif" ALT="/\"><TD bgcolor="#EEEEEE"><SMALL> Calling <TT>PlayerTo(place, 1);</TT> moves the player but prints
nothing (in particular, prints no room description).
</SMALL>
<TR><TD><TD><P>

<P><TR><TD Valign="top"><IMG SRC="icons/dbend.gif" ALT="/\"><TD bgcolor="#EEEEEE"><SMALL> Calling <TT>PlayerTo(place, 2);</TT> will <TT>Look</TT> as if the player had
arrived in the room by walking in as usual, so only a short description
appears if the room is one that has been seen before.
</SMALL>
<TR><TD><TD><P>

<P><TR><TD Valign="top"><IMG SRC="icons/dbend.gif" ALT="/\"><TD bgcolor="#EEEEEE"><SMALL> In a process called 'scoring arrival', a room which the player has entered
for the first time is given the <TT>visited</TT> attribute.  If it was listed
as <TT>scored</TT>, points are awarded.  (See <A HREF="section14.html">Section 14</A>.)
</SMALL>
<TR><TD><TD><P>

<P><TR><TD Valign="top"><IMG SRC="icons/ddbend.gif" ALT="/\/\"><TD bgcolor="#EEEEEE"><SMALL> When a <TT>Look</TT> action takes place, or a call to <TT>PlayerTo(place,1)</TT>,
the library 'notes arrival' as well as 'scores arrival'.
'Noting arrival' consists of checking to see if the room has changed
since last time (darkness counting as a different room for this purpose).
If so, the following happens:

<P>1. --  If the new location has an <TT>initial</TT> property, this is printed
if it's a string, or run if it's a routine.
<P>2. --  The entry point <TT>NewRoom</TT> is called (if it exists).
<P>3. --  Any 'floating objects', such as drifting mist, which are <TT>found_in</TT>
many places at once, are moved into the room.

<P>
</SMALL>
<TR><TD><TD><P>


The player's whole persona can easily be changed, because the player object
can itself have an <TT>orders</TT> routine, just as the object for any non-player
character can.  To replace the <TT>orders</TT> routine for the standard <TT>player</TT>
object, set
<PRE>
player.orders = MyNewRule;
</PRE>

where <TT>MyNewRule</TT> is a new <TT>orders</TT> rule.  Note that this is applied to
every action or order issued by the player.  The variable <TT>actor</TT> holds the
person being told to do something, which may well be the player himself,
and the variables <TT>action</TT>, <TT>noun</TT> and <TT>second</TT> are set up as usual.
For instance, if a cannon goes off right next to the player,
a period of partial deafness might ensue:
<PRE>
[ MyNewRule;
  if (actor~=player) rfalse;
  Listen: "Your hearing is still weak from all that cannon-fire.";
];
</PRE>

The <TT>if</TT> statement needs to be there to prevent commands like
"helena, listen'' from being ruled out -- after all, the player
can still speak.
<P>

<P><TR><TD Valign="top"><IMG SRC="icons/dexercise.gif" ALT="??/\"><TD bgcolor="#FBB9AC"><A NAME="ex42"><B>EXERCISE 42:</B><BR>(link to <A HREF="answers1/answer42.html">the answer</A>)<TR><TD><TD> Why not achieve the same effect by giving the player
a <TT>react_before</TT> rule instead?
<P>

<P><TR><TD Valign="top"><IMG SRC="icons/exercise.gif" ALT="??"><TD bgcolor="#FBB9AC"><A NAME="ex43"><B>EXERCISE 43:</B><BR>(link to <A HREF="answers1/answer43.html">the answer</A>)<TR><TD><TD> (Cf. 'Curses'.)  Write an <TT>orders</TT> routine for the player
so that wearing the gas mask will prevent him from
talking.


<P>

<P><TR><TD Valign="top"><IMG SRC="icons/dbend.gif" ALT="/\"><TD bgcolor="#EEEEEE"><SMALL> In fact a much more powerful trick is available: the <TT>player</TT> can
actually become a different character in the game, allowing the real player
at the keyboard to act through someone else.
Calling <TT>ChangePlayer(obj)</TT> will transform the player to <TT>obj</TT>.  There's
no need for <TT>obj</TT> to have names like "me'' or "myself''; the
parser understands these words automatically to refer to the
currently-inhabited <TT>player</TT> object.  However, it must provide a <TT>number</TT>
property (which the library will use for workspace).  The maximum number
of items the player can carry as that object will be its <TT>capacity</TT>.  Finally,
since <TT>ChangePlayer</TT> prints nothing, you may want to conclude with a <TT>&#60;&#60;Look&#62;&#62;;</TT>
</SMALL>
<TR><TD><TD><P>

<TR><TD><TD bgcolor="#EEEEEE"><SMALL> <TT>ChangePlayer</TT> has many possible applications.  The player
who tampers with Dr Frankenstein's brain transference machine may
suddenly become the Monster strapped to the table.  A player who drinks
too much wine could become a 'drunk player object' to whom many different
rules apply.  The "snavig'' spell of 'Spellbreaker', which transforms
the player to an animal like the one cast upon, could be implemented thus.
More ambitiously, a game could have a stock of half a dozen main characters,
and the focus of play can switch between them.  A player might have a team
of four adventurers to explore a dungeon, and be able to switch the one
being controlled by typing the name.  In this case, an <TT>AfterLife</TT> routine
-- see below -- may be needed to switch the focus back to a still-living
member of the team after one has met a sticky end.
<P>

<P><TR><TD Valign="top"><IMG SRC="icons/dbend.gif" ALT="/\"><TD bgcolor="#EEEEEE"><SMALL> Calling <TT>ChangePlayer(object,1);</TT> will do the same but make the
game print "(as Whoever)'' during room descriptions.
</SMALL>
<TR><TD><TD><P>

<P><TR><TD Valign="top"><IMG SRC="icons/ddbend.gif" ALT="/\/\"><TD bgcolor="#EEEEEE"><SMALL> When the person to be changed into has an <TT>orders</TT> routine,
things start to get complicated.  It may be useful to arrange such a
routine as follows:
<PRE>
      orders
      [;  if (player==self)
          {   ! I am the player object...
              if (actor==self)
              {   ! ...giving myself an order, i.e., trying an action.
              }
              else
              {   ! ...giving someone else, the "actor", an order.
              }
          }
          else
          {   ! The player is the "actor" and is giving me an order.
          }
      ],
</PRE>

</SMALL><TR><TD><TD>
</SMALL>
<TR><TD><TD><P>

<P><TR><TD Valign="top"><IMG SRC="icons/dexercise.gif" ALT="??/\"><TD bgcolor="#FBB9AC"><A NAME="ex44"><B>EXERCISE 44:</B><BR>(link to <A HREF="answers1/answer44.html">the answer</A>)<TR><TD><TD> In Central American legend, a sorceror can transform himself
into a <I> nagual</I>, a familiar such as a spider-monkey; indeed, each
individual has an animal self or <I> wayhel</I>, living in a volcanic land
over which the king, as a jaguar, rules.  Turn the player into his
<I> wayhel</I>.
<P>

<P><TR><TD Valign="top"><IMG SRC="icons/ddexercise.gif" ALT="??/\/\"><TD bgcolor="#FBB9AC"><A NAME="ex45"><B>EXERCISE 45:</B><BR>(link to <A HREF="answers1/answer45.html">the answer</A>)<TR><TD><TD> Write an <TT>orders</TT> routine for a Giant with a conscience,
who will refuse to attack a mouse, but so that a player who becomes
the Giant can be as cruel as he likes.
<P>

<P>
The player is still alive for as long as the variable <TT>deadflag</TT> is zero.
When set to 1, the player dies; when set to 2, the player wins; and all higher
values are taken as more exotic forms of death.  Now Inform does not know
what to call these exotica: so if they should arise, it calls the
<TT>DeathMessage</TT> routine, which is expected to look at <TT>deadflag</TT> and
can then print something like "You have changed''.
<P>

Many games allow reincarnation (or, as David M. Baggett points out, in
fact resurrection).
You too can allow this, by providing an <TT>AfterLife</TT>.
This routine gets the chance to do as it pleases before any "You are
dead'' type message appears, including resetting <TT>deadflag</TT> back to 0 --
which causes the game to proceed in the normal way, rather than end.
<TT>AfterLife</TT> routines can be tricky to write, though, because the game
has to be set to a state which convincingly reflects what has happened.
<P>

<P><TR><TD Valign="top"><IMG SRC="icons/refs.gif" ALT="*"><TD bgcolor="#EEEEEE"><B>REFERENCES:</B><BR><SMALL>
The magic words "xyzzy'' and "plugh'' in 'Advent' make use of
<TT>PlayerTo</TT>.
<BR>
'Advent' has an amusing <TT>AfterLife</TT> routine: for instance,
try collapsing the bridge by leading the bear across, then returning
to the scene after resurrection.  'Balances' has one which only
slightly penalises death.
</SMALL>
<TR><TD><TD><P>


</TABLE>
<HR><A HREF="contents.html">Contents</A> / <A HREF="section18.html">Back</A> / <A HREF="section20.html">Forward</A> <BR>
<A HREF="chapter1.html">Chapter I</A> / <A HREF="chapter2.html">Chapter II</A> / <A HREF="chapter3.html">Chapter III</A> / <A HREF="chapter4.html">Chapter IV</A> / <A HREF="chapter5.html">Chapter V</A> / <A HREF="chapter6.html">Chapter VI</A> / <A HREF="chapterA.html">Appendix</A><HR><SMALL><I>Mechanically translated to HTML from third edition as revised 16 May 1997. Copyright &#169; Graham Nelson 1993, 1994, 1995, 1996, 1997: all rights reserved.</I></SMALL></BODY></HTML>
