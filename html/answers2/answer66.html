<HTML><HEAD><TITLE>Answer to Exercise 66</TITLE></HEAD>
<BODY BGCOLOR="#FFFFFF">
<TABLE><TR><TD Valign="top"><IMG SRC="../icons/exercise.gif" ALT="??"><TD bgcolor="#FAA89B"><B>ANSWER TO EXERCISE 66</B><TR><TD><TD>
<P>


The scheme will work like this: any room that ought to have a name
should have a <TT>place_name</TT> property set to a dictionary word;
say, the Bedquilt cave could be called <TT>'bedquilt'</TT>.  Clearly
you should only be allowed to type this from adjacent rooms.
So we'll implement the following: you can only move by name to
those rooms listed in the current room's <TT>to_places</TT> property.
For instance, the Soft Room might have <TT>to_places</TT> set to
<PRE>
to_places Bedquilt Slab_Room Twopit_Room;
</PRE>

Now the code: if the player's verb is not otherwise understood,
we'll check it to see if it's a place name of a nearby room,
and if so store that room's object number in <TT>goto_room</TT>, converting
the verb to <TT>'go#room'</TT> (which we'll deal with below).
<PRE>
Global goto_room;
[ UnknownVerb word p i;
    p = location.&#38;to_places; if (p==0) rfalse;
    for (i=0:(2*i)&#60;location.#to_places:i++)
        if (word==(p--&#62;i).place_name)
        {   goto_room = p--&#62;i; return 'go#room';
        }
    rfalse;
];
[ PrintVerb word;
    if (word=='go#room')
    {   print "go to ", (name) goto_room; rtrue; }
    rfalse;
];
</PRE>

(The supplied <TT>PrintVerb</TT> is icing on the cake: so the parser can
say something like "I only understood you as far as wanting to go to
Bedquilt.'' in reply to, say, "bedquilt the nugget''.)  It remains
only to create the dummy verb:
<PRE>
[ GoRoomSub;
    if (goto_room hasnt visited) "But you have never been there.";
    PlayerTo(goto_room);
];
Verb "go#room"  *                                -&#62; GoRoom;
</PRE>

Note that if you don't know the way, you can't go there!  A purist might
prefer instead to not recognise the name of an unvisited room, back at
the <TT>UnknownVerb</TT> stage, to avoid the player being able to deduce names
of nearby rooms from this 'error message'.}
<P>
</TABLE>
<HR>Back to <A HREF="../section26.html#ex66">the exercise in section 26</A><HR>
<SMALL><I>Mechanically translated to HTML from third edition as revised 16 May 1997. Copyright &#169; Graham Nelson 1993, 1994, 1995, 1996, 1997: all rights reserved.</I></SMALL></BODY></HTML>
